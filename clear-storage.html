<!DOCTYPE html>
<html>
<head>
    <title>æ¸…ç†LocalStorage</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        button { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        button:hover { background: #2563eb; }
        .warning { background: #fef3c7; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #e0f2fe; padding: 15px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ æŠ•ç¥¨ç³»ç»Ÿ LocalStorage æ¸…ç†å·¥å…·</h1>
        
        <div class="warning">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong>æ­¤å·¥å…·å°†æ¸…ç†æµè§ˆå™¨ä¸­å­˜å‚¨çš„æŠ•ç¥¨ç›¸å…³æ•°æ®ã€‚æ¸…ç†åæ‚¨éœ€è¦é‡æ–°è¿›è¡ŒæŠ•ç¥¨ã€‚
        </div>
        
        <h2>å½“å‰ LocalStorage å†…å®¹ï¼š</h2>
        <pre id="current-storage"></pre>
        
        <h2>æ“ä½œé€‰é¡¹ï¼š</h2>
        <button onclick="showCurrentStorage()">ğŸ” æŸ¥çœ‹å½“å‰å­˜å‚¨</button>
        <button onclick="clearVoteData()">ğŸ—‘ï¸ æ¸…ç†æŠ•ç¥¨æ•°æ®</button>
        <button onclick="clearAllData()">ğŸš¨ æ¸…ç†æ‰€æœ‰æ•°æ®</button>
        <button onclick="generateNewUserId()">ğŸ†” é‡æ–°ç”Ÿæˆç”¨æˆ·ID</button>
        
        <div class="info" id="result"></div>
        
        <h2>ä½¿ç”¨è¯´æ˜ï¼š</h2>
        <ul>
            <li><strong>æŸ¥çœ‹å½“å‰å­˜å‚¨ï¼š</strong>æ˜¾ç¤ºæ‰€æœ‰ä¿å­˜çš„æ•°æ®</li>
            <li><strong>æ¸…ç†æŠ•ç¥¨æ•°æ®ï¼š</strong>åªæ¸…ç†æŠ•ç¥¨ç›¸å…³çš„æ•°æ®ï¼Œä¿ç•™å…¶ä»–è®¾ç½®</li>
            <li><strong>æ¸…ç†æ‰€æœ‰æ•°æ®ï¼š</strong>æ¸…ç†æ•´ä¸ª LocalStorage</li>
            <li><strong>é‡æ–°ç”Ÿæˆç”¨æˆ·IDï¼š</strong>ç”Ÿæˆæ–°çš„æœ‰æ•ˆUUIDæ ¼å¼ç”¨æˆ·ID</li>
        </ul>
    </div>

    <script>
        // UUIDéªŒè¯å‡½æ•°
        function isValidUUID(uuid) {
            const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
            return uuidRegex.test(uuid);
        }
        
        // ç”ŸæˆUUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // æ˜¾ç¤ºå½“å‰å­˜å‚¨
        function showCurrentStorage() {
            const storage = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                storage[key] = value;
            }
            
            document.getElementById('current-storage').textContent = 
                Object.keys(storage).length > 0 ? 
                JSON.stringify(storage, null, 2) : 
                'æ— å­˜å‚¨æ•°æ®';
            
            // æ£€æŸ¥ç”¨æˆ·IDæ ¼å¼
            const userId = localStorage.getItem('user-id');
            let message = `å‘ç° ${Object.keys(storage).length} ä¸ªå­˜å‚¨é¡¹ã€‚`;
            
            if (userId) {
                if (isValidUUID(userId)) {
                    message += ` âœ… ç”¨æˆ·IDæ ¼å¼æ­£ç¡®: ${userId}`;
                } else {
                    message += ` âŒ ç”¨æˆ·IDæ ¼å¼é”™è¯¯: ${userId}`;
                }
            } else {
                message += ' â„¹ï¸ æœªæ‰¾åˆ°ç”¨æˆ·IDã€‚';
            }
            
            showResult(message);
        }
        
        // æ¸…ç†æŠ•ç¥¨æ•°æ®
        function clearVoteData() {
            const keysToRemove = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.startsWith('poll-') || key === 'user-id' || key === 'current-user-id')) {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            showResult(`âœ… å·²æ¸…ç† ${keysToRemove.length} ä¸ªæŠ•ç¥¨ç›¸å…³æ•°æ®é¡¹: ${keysToRemove.join(', ')}`);
            showCurrentStorage();
        }
        
        // æ¸…ç†æ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰LocalStorageæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                const count = localStorage.length;
                localStorage.clear();
                showResult(`âœ… å·²æ¸…ç†æ‰€æœ‰æ•°æ®ï¼Œå…± ${count} ä¸ªé¡¹ç›®ã€‚`);
                showCurrentStorage();
            }
        }
        
        // é‡æ–°ç”Ÿæˆç”¨æˆ·ID
        function generateNewUserId() {
            const oldId = localStorage.getItem('user-id');
            const newId = generateUUID();
            localStorage.setItem('user-id', newId);
            
            let message = `âœ… å·²ç”Ÿæˆæ–°çš„ç”¨æˆ·ID: ${newId}`;
            if (oldId) {
                message += `\næ—§ID: ${oldId}`;
            }
            
            showResult(message);
            showCurrentStorage();
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(message) {
            document.getElementById('result').innerHTML = '<strong>æ“ä½œç»“æœï¼š</strong><br>' + message.replace(/\n/g, '<br>');
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰å­˜å‚¨
        window.onload = function() {
            showCurrentStorage();
        }
    </script>
</body>
</html>
